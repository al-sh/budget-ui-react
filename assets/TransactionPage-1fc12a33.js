import{r as i,H as p,ae as h,a as j,j as s,o as E,B as S,b as F,L as C,U as A}from"./index-34d4c4ba.js";import{D as N,A as x}from"./DatePicker-b24118ec.js";import{T as c,C as D}from"./TransactionTypeSelect-df642144.js";import{F as l}from"./index-d9ae56b4.js";import{I as P}from"./index-cf23df92.js";import{I as R}from"./index-56f64d49.js";import{C as v}from"./index-c8bada9e.js";import{F as w}from"./FormHeader-83de6a6f.js";import"./Select-b87e8223.js";import"./KeyCode-6413d982.js";import"./index-fb18f883.js";import"./useMergedState-79f96c76.js";const q=({transaction:e})=>{const[m]=l.useForm(),[u,o]=i.useState(e!=null&&e.typeId?e.typeId:p.EXPENSE),{useItem:r}=h(),t=r("PUT",{id:(e==null?void 0:e.id)??""}),I=r("POST",{id:(e==null?void 0:e.id)??""}),g=j(),[y,T]=i.useState(!0),[f,b]=i.useState(!1);return s.jsx("div",{children:s.jsxs(l,{name:"transactionForm",form:m,labelCol:{span:8},onValuesChange:()=>{o(m.getFieldValue("typeId")),T(m.getFieldsError().filter(({errors:d})=>d.length).length>0)},layout:"horizontal",labelAlign:"left",preserve:!0,wrapperCol:{span:16},initialValues:{accountId:(e==null?void 0:e.accountId)||"",amount:!!(e!=null&&e.amount)&&(e==null?void 0:e.amount)/100||void 0,categoryId:(e==null?void 0:e.categoryId)||"",description:(e==null?void 0:e.description)||"",dt:E(e==null?void 0:e.dt)||new Date,toAccountId:(e==null?void 0:e.toAccountId)||"",typeId:(e==null?void 0:e.typeId)||p.EXPENSE},onFinish:d=>{e!=null&&e.id?t.mutate(d):I.mutate(d),m.setFieldsValue({amount:void 0,description:""}),!f&&g(-1)},autoComplete:"off",children:[s.jsx(l.Item,{label:"Дата",name:"dt",rules:[{message:"Укажите дату",required:!0}],children:s.jsx(N,{withTime:!0})}),s.jsx(l.Item,{label:"Сумма",name:"amount",rules:[{message:"Укажите сумму",required:!0}],children:s.jsx(P,{style:{width:"100%"},formatter:d=>`${d}`,parser:d=>d?d.replace(",","."):""})}),s.jsx(l.Item,{label:"Счет",name:"accountId",rules:[{message:"Выберите счет",required:!0}],children:s.jsx(x,{})}),s.jsx(l.Item,{label:"Тип",name:"typeId",rules:[{message:"Выберите тип",required:!0}],children:s.jsx(c,{})}),u===p.TRANSFER&&s.jsx(l.Item,{label:"Счет пополнения",name:"toAccountId",rules:[{message:"Выберите счет пополнения",required:!0}],children:s.jsx(x,{})}),u!==p.TRANSFER&&s.jsx(l.Item,{label:"Категория",name:"categoryId",rules:[{message:"Выберите категорию",required:!0}],children:s.jsx(D,{typeId:u})}),s.jsx(l.Item,{label:"Описание",name:"description",children:s.jsx(R,{})}),!e&&s.jsx(v,{onChange:d=>{b(d.target.checked)},children:"Создать еще"}),s.jsx(l.Item,{wrapperCol:{offset:8,span:16},children:s.jsx(S,{type:"primary",htmlType:"submit",disabled:y,children:"Сохранить"})})]})})},G=()=>{const{transactionId:e}=F(),{useGetOne:m,useItem:u}=h(),o=u("DELETE",{id:e}),{isFetching:r,data:t}=m(e||""),I=j();return s.jsxs(s.Fragment,{children:[r&&s.jsx(C,{}),e&&e!=="new"&&s.jsx(w,{text:"Редактирование транзакции",onDeleteButtonClick:()=>{confirm("Удалить транзакцию?")&&(o.mutate({}),I(A.TRANSACTIONS))}}),e==="new"&&s.jsx("div",{children:"Новая транзакция"}),!r&&s.jsx(q,{transaction:t})]})};export{G as TransactionsPage,G as default};
