import{r as c,$ as Vt,J as le,a0 as se,O as Ue,I as xt,Y as H,a2 as qe,K as xe,a9 as $t,M as Ft,S as Wt,ag as jt,q as mt,a8 as Ut,N as zt,au as Qt,av as Gt,H as O,aw as Xt,ax as Bt,m as tt,ay as et,j as rt}from"./index-e97f3cb2.js";import{u as Yt,a as qt,B as Jt,g as Zt,d as er}from"./index-701a036c.js";import{T as tr,c as rr,e as nt,r as nr,S as ar,d as or}from"./Select-6d7dc402.js";import{u as gt}from"./useMergedState-82a668f8.js";import{K as Oe}from"./KeyCode-6413d982.js";import{t as ir,d as lr,e as sr,g as Ct,j as cr,f as ur}from"./index-41bdc4f4.js";var bt=c.createContext(null),wt=c.createContext(null);function dr(e){return Array.isArray(e)?e:e!==void 0?[e]:[]}function fr(e){var t=e||{},n=t.label,r=t.value,o=t.children,l=r||"value";return{_title:n?[n]:["title","label"],value:l,key:l,children:o||"children"}}function at(e){return!e||e.disabled||e.disableCheckbox||e.checkable===!1}function vr(e,t){var n=[];function r(o){o.forEach(function(l){var s=l[t.children];s&&(n.push(l[t.value]),r(s))})}return r(e),n}function yt(e){return e==null}var hr={width:0,height:0,display:"flex",overflow:"hidden",opacity:0,border:0,padding:0,margin:0},pr=function(t,n){var r=Yt(),o=r.prefixCls,l=r.multiple,s=r.searchValue,i=r.toggleOpen,a=r.open,u=r.notFoundContent,d=c.useContext(wt),w=d.virtual,S=d.listHeight,I=d.listItemHeight,D=d.treeData,b=d.fieldNames,$=d.onSelect,F=d.dropdownMatchSelectWidth,W=d.treeExpandAction,m=c.useContext(bt),L=m.checkable,P=m.checkedKeys,q=m.halfCheckedKeys,R=m.treeExpandedKeys,Re=m.treeDefaultExpandAll,ce=m.treeDefaultExpandedKeys,be=m.onTreeExpand,Ve=m.treeIcon,ue=m.showTreeIcon,we=m.switcherIcon,J=m.treeLine,V=m.treeNodeFilterProp,Te=m.loadData,j=m.treeLoadedKeys,Ne=m.treeMotion,G=m.onTreeLoad,ke=m.keyEntities,X=c.useRef(),de=Vt(function(){return D},[a,D],function(f,E){return E[0]&&f[1]!==E[1]}),T=c.useMemo(function(){return L?{checked:P,halfChecked:q}:null},[L,P,q]);c.useEffect(function(){if(a&&!l&&P.length){var f;(f=X.current)===null||f===void 0||f.scrollTo({key:P[0]})}},[a]);var fe=String(s).toLowerCase(),Z=function(E){return fe?String(E[V]).toLowerCase().includes(fe):!1},ee=c.useState(ce),ve=le(ee,2),te=ve[0],De=ve[1],he=c.useState(null),pe=le(he,2),U=pe[0],me=pe[1],re=c.useMemo(function(){return R?se(R):s?U:te},[te,U,R,s]);c.useEffect(function(){s&&me(vr(D,b))},[s]);var $e=function(E){De(E),me(E),be&&be(E)},B=function(E){E.preventDefault()},z=function(E,Y){var K=Y.node;L&&at(K)||($(K.key,{selected:!P.includes(K.key)}),l||i(!1))},ne=c.useState(null),_=le(ne,2),ge=_[0],Le=_[1],N=ke[ge];if(c.useImperativeHandle(n,function(){var f;return{scrollTo:(f=X.current)===null||f===void 0?void 0:f.scrollTo,onKeyDown:function(Y){var K,Pe=Y.which;switch(Pe){case Oe.UP:case Oe.DOWN:case Oe.LEFT:case Oe.RIGHT:(K=X.current)===null||K===void 0||K.onKeyDown(Y);break;case Oe.ENTER:{if(N){var ye=(N==null?void 0:N.node)||{},ae=ye.selectable,Me=ye.value;ae!==!1&&z(null,{node:{key:ge},selected:!P.includes(Me)})}break}case Oe.ESC:i(!1)}},onKeyUp:function(){}}}),de.length===0)return c.createElement("div",{role:"listbox",className:"".concat(o,"-empty"),onMouseDown:B},u);var Ce={fieldNames:b};return j&&(Ce.loadedKeys=j),re&&(Ce.expandedKeys=re),c.createElement("div",{onMouseDown:B},N&&a&&c.createElement("span",{style:hr,"aria-live":"assertive"},N.node.value),c.createElement(tr,Ue({ref:X,focusable:!1,prefixCls:"".concat(o,"-tree"),treeData:de,height:S,itemHeight:I,virtual:w!==!1&&F!==!1,multiple:l,icon:Ve,showIcon:ue,switcherIcon:we,showLine:J,loadData:s?null:Te,motion:Ne,activeKey:ge,checkable:L,checkStrictly:!0,checkedKeys:T,selectedKeys:L?[]:P,defaultExpandAll:Re},Ce,{onActiveChange:Le,onSelect:z,onCheck:z,onExpand:$e,onLoad:G,filterTreeNode:Z,expandAction:W})))},Tt=c.forwardRef(pr);Tt.displayName="OptionList";var it=function(){return null},Nt="SHOW_ALL",lt="SHOW_PARENT",Je="SHOW_CHILD";function St(e,t,n,r){var o=new Set(e);return t===Je?e.filter(function(l){var s=n[l];return!(s&&s.children&&s.children.some(function(i){var a=i.node;return o.has(a[r.value])})&&s.children.every(function(i){var a=i.node;return at(a)||o.has(a[r.value])}))}):t===lt?e.filter(function(l){var s=n[l],i=s?s.parent:null;return!(i&&!at(i.node)&&o.has(i.key))}):e}var mr=["children","value"];function kt(e){return ir(e).map(function(t){if(!c.isValidElement(t)||!t.type)return null;var n=t,r=n.key,o=n.props,l=o.children,s=o.value,i=xt(o,mr),a=H({key:r,value:s},i),u=kt(l);return u.length&&(a.children=u),a}).filter(function(t){return t})}function ot(e){if(!e)return e;var t=H({},e);return"props"in t||Object.defineProperty(t,"props",{get:function(){return qe(!1,"New `rc-tree-select` not support return node instance as argument anymore. Please consider to remove `props` access."),t}}),t}function gr(e,t,n,r,o,l){var s=null,i=null;function a(){function u(d){var w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"0",S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return d.map(function(I,D){var b="".concat(w,"-").concat(D),$=I[l.value],F=n.includes($),W=u(I[l.children]||[],b,F),m=c.createElement(it,I,W.map(function(P){return P.node}));if(t===$&&(s=m),F){var L={pos:b,node:m,children:W};return S||i.push(L),L}return null}).filter(function(I){return I})}i||(i=[],u(r),i.sort(function(d,w){var S=d.node.props.value,I=w.node.props.value,D=n.indexOf(S),b=n.indexOf(I);return D-b}))}Object.defineProperty(e,"triggerNode",{get:function(){return qe(!1,"`triggerNode` is deprecated. Please consider decoupling data with node."),a(),s}}),Object.defineProperty(e,"allCheckedNodes",{get:function(){return qe(!1,"`allCheckedNodes` is deprecated. Please consider decoupling data with node."),a(),o?i:i.map(function(d){var w=d.node;return w})}})}function Cr(e,t){var n=t.id,r=t.pId,o=t.rootPId,l={},s=[],i=e.map(function(a){var u=H({},a),d=u[n];return l[d]=u,u.key=u.key||d,u});return i.forEach(function(a){var u=a[r],d=l[u];d&&(d.children=d.children||[],d.children.push(a)),(u===o||!d&&o===null)&&s.push(a)}),s}function yr(e,t,n){return c.useMemo(function(){return e?n?Cr(e,H({id:"id",pId:"pId",rootPId:null},n!==!0?n:{})):e:kt(t)},[t,n,e])}const Sr=function(e){var t=c.useRef({valueLabels:new Map});return c.useMemo(function(){var n=t.current.valueLabels,r=new Map,o=e.map(function(l){var s,i=l.value,a=(s=l.label)!==null&&s!==void 0?s:n.get(i);return r.set(i,a),H(H({},l),{},{label:a})});return t.current.valueLabels=r,[o]},[e])};function It(e){var t=c.useRef();t.current=e;var n=c.useCallback(function(){return t.current.apply(t,arguments)},[]);return n}const Ir=function(e,t){return c.useMemo(function(){var n=rr(e,{fieldNames:t,initWrapper:function(o){return H(H({},o),{},{valueEntities:new Map})},processEntity:function(o,l){var s=o.node[t.value];l.valueEntities.set(s,o)}});return n},[e,t])},Er=function(e,t,n,r){return c.useMemo(function(){var o=e.map(function(a){var u=a.value;return u}),l=t.map(function(a){var u=a.value;return u}),s=o.filter(function(a){return!r[a]});if(n){var i=nt(o,!0,r);o=i.checkedKeys,l=i.halfCheckedKeys}return[Array.from(new Set([].concat(se(s),se(o)))),l]},[e,t,n,r])},xr=function(e,t,n){var r=n.treeNodeFilterProp,o=n.filterTreeNode,l=n.fieldNames,s=l.children;return c.useMemo(function(){if(!t||o===!1)return e;var i;if(typeof o=="function")i=o;else{var a=t.toUpperCase();i=function(w,S){var I=S[r];return String(I).toUpperCase().includes(a)}}function u(d){var w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return d.map(function(S){var I=S[s],D=w||i(t,ot(S)),b=u(I||[],D);return D||b.length?H(H({},S),{},xe({isLeaf:void 0},s,b)):null}).filter(function(S){return S})}return u(e)},[e,t,s,r,o])};var br=["id","prefixCls","value","defaultValue","onChange","onSelect","onDeselect","searchValue","inputValue","onSearch","autoClearSearchValue","filterTreeNode","treeNodeFilterProp","showCheckedStrategy","treeNodeLabelProp","multiple","treeCheckable","treeCheckStrictly","labelInValue","fieldNames","treeDataSimpleMode","treeData","children","loadData","treeLoadedKeys","onTreeLoad","treeDefaultExpandAll","treeExpandedKeys","treeDefaultExpandedKeys","onTreeExpand","treeExpandAction","virtual","listHeight","listItemHeight","onDropdownVisibleChange","dropdownMatchSelectWidth","treeLine","treeIcon","showTreeIcon","switcherIcon","treeMotion"];function wr(e){return!e||$t(e)!=="object"}var Tr=c.forwardRef(function(e,t){var n=e.id,r=e.prefixCls,o=r===void 0?"rc-tree-select":r,l=e.value,s=e.defaultValue,i=e.onChange,a=e.onSelect,u=e.onDeselect,d=e.searchValue,w=e.inputValue,S=e.onSearch,I=e.autoClearSearchValue,D=I===void 0?!0:I,b=e.filterTreeNode,$=e.treeNodeFilterProp,F=$===void 0?"value":$,W=e.showCheckedStrategy,m=W===void 0?Je:W,L=e.treeNodeLabelProp,P=e.multiple,q=e.treeCheckable,R=e.treeCheckStrictly,Re=e.labelInValue,ce=e.fieldNames,be=e.treeDataSimpleMode,Ve=e.treeData,ue=e.children,we=e.loadData,J=e.treeLoadedKeys,V=e.onTreeLoad,Te=e.treeDefaultExpandAll,j=e.treeExpandedKeys,Ne=e.treeDefaultExpandedKeys,G=e.onTreeExpand,ke=e.treeExpandAction,X=e.virtual,de=e.listHeight,T=de===void 0?200:de,fe=e.listItemHeight,Z=fe===void 0?20:fe,ee=e.onDropdownVisibleChange,ve=e.dropdownMatchSelectWidth,te=ve===void 0?!0:ve,De=e.treeLine,he=e.treeIcon,pe=e.showTreeIcon,U=e.switcherIcon,me=e.treeMotion,re=xt(e,br),$e=qt(n),B=q&&!R,z=q||R,ne=R||Re,_=z||P,ge=gt(s,{value:l}),Le=le(ge,2),N=Le[0],Ce=Le[1],f=c.useMemo(function(){return fr(ce)},[JSON.stringify(ce)]),E=gt("",{value:d!==void 0?d:w,postState:function(v){return v||""}}),Y=le(E,2),K=Y[0],Pe=Y[1],ye=function(v){Pe(v),S==null||S(v)},ae=yr(Ve,ue,be),Me=Ir(ae,f),A=Me.keyEntities,Se=Me.valueEntities,st=c.useCallback(function(h){var v=[],p=[];return h.forEach(function(g){Se.has(g)?p.push(g):v.push(g)}),{missingRawValues:v,existRawValues:p}},[Se]),ct=xr(ae,K,{fieldNames:f,treeNodeFilterProp:F,filterTreeNode:b}),ut=c.useCallback(function(h){if(h){if(L)return h[L];for(var v=f._title,p=0;p<v.length;p+=1){var g=h[v[p]];if(g!==void 0)return g}}},[f,L]),Fe=c.useCallback(function(h){var v=dr(h);return v.map(function(p){return wr(p)?{value:p}:p})},[]),Ge=c.useCallback(function(h){var v=Fe(h);return v.map(function(p){var g=p.label,M=p.value,x=p.halfChecked,C,y=Se.get(M);if(y){var k;g=(k=g)!==null&&k!==void 0?k:ut(y.node),C=y.node.disabled}else if(g===void 0){var oe=Fe(N).find(function(We){return We.value===M});g=oe.label}return{label:g,value:M,halfChecked:x,disabled:C}})},[Se,ut,Fe,N]),dt=c.useMemo(function(){return Fe(N)},[Fe,N]),Dt=c.useMemo(function(){var h=[],v=[];return dt.forEach(function(p){p.halfChecked?v.push(p):h.push(p)}),[h,v]},[dt]),ft=le(Dt,2),_e=ft[0],vt=ft[1],ht=c.useMemo(function(){return _e.map(function(h){return h.value})},[_e]),Lt=Er(_e,vt,B,A),pt=le(Lt,2),Ke=pt[0],Xe=pt[1],Pt=c.useMemo(function(){var h=St(Ke,m,A,f),v=h.map(function(x){var C,y,k;return(C=(y=A[x])===null||y===void 0||(k=y.node)===null||k===void 0?void 0:k[f.value])!==null&&C!==void 0?C:x}),p=v.map(function(x){var C=_e.find(function(y){return y.value===x});return{value:x,label:C==null?void 0:C.label}}),g=Ge(p),M=g[0];return!_&&M&&yt(M.value)&&yt(M.label)?[]:g.map(function(x){var C;return H(H({},x),{},{label:(C=x.label)!==null&&C!==void 0?C:x.value})})},[f,_,Ke,_e,Ge,m,A]),Mt=Sr(Pt),_t=le(Mt,1),Kt=_t[0],Be=It(function(h,v,p){var g=Ge(h);if(Ce(g),D&&Pe(""),i){var M=h;if(B){var x=St(h,m,A,f);M=x.map(function(Q){var ie=Se.get(Q);return ie?ie.node[f.value]:Q})}var C=v||{triggerValue:void 0,selected:void 0},y=C.triggerValue,k=C.selected,oe=M;if(R){var We=vt.filter(function(Q){return!M.includes(Q.value)});oe=[].concat(se(oe),se(We))}var je=Ge(oe),Ie={preValue:_e,triggerValue:y},Ae=!0;(R||p==="selection"&&!k)&&(Ae=!1),gr(Ie,y,h,ae,Ae,f),z?Ie.checked=k:Ie.selected=k;var Ye=ne?je:je.map(function(Q){return Q.value});i(_?Ye:Ye[0],ne?null:je.map(function(Q){return Q.label}),Ie)}}),Ze=c.useCallback(function(h,v){var p,g=v.selected,M=v.source,x=A[h],C=x==null?void 0:x.node,y=(p=C==null?void 0:C[f.value])!==null&&p!==void 0?p:h;if(!_)Be([y],{selected:!0,triggerValue:y},"option");else{var k=g?[].concat(se(ht),[y]):Ke.filter(function(ie){return ie!==y});if(B){var oe=st(k),We=oe.missingRawValues,je=oe.existRawValues,Ie=je.map(function(ie){return Se.get(ie).key}),Ae;if(g){var Ye=nt(Ie,!0,A);Ae=Ye.checkedKeys}else{var Q=nt(Ie,{checked:!1,halfCheckedKeys:Xe},A);Ae=Q.checkedKeys}k=[].concat(se(We),se(Ae.map(function(ie){return A[ie].node[f.value]})))}Be(k,{selected:g,triggerValue:y},M||"option")}g||!_?a==null||a(y,ot(C)):u==null||u(y,ot(C))},[st,Se,A,f,_,ht,Be,B,a,u,Ke,Xe]),At=c.useCallback(function(h){if(ee){var v={};Object.defineProperty(v,"documentClickClose",{get:function(){return qe(!1,"Second param of `onDropdownVisibleChange` has been removed."),!1}}),ee(h,v)}},[ee]),Ot=It(function(h,v){var p=h.map(function(g){return g.value});if(v.type==="clear"){Be(p,{},"selection");return}v.values.length&&Ze(v.values[0].value,{selected:!1,source:"selection"})}),Ht=c.useMemo(function(){return{virtual:X,dropdownMatchSelectWidth:te,listHeight:T,listItemHeight:Z,treeData:ct,fieldNames:f,onSelect:Ze,treeExpandAction:ke}},[X,te,T,Z,ct,f,Ze,ke]),Rt=c.useMemo(function(){return{checkable:z,loadData:we,treeLoadedKeys:J,onTreeLoad:V,checkedKeys:Ke,halfCheckedKeys:Xe,treeDefaultExpandAll:Te,treeExpandedKeys:j,treeDefaultExpandedKeys:Ne,onTreeExpand:G,treeIcon:he,treeMotion:me,showTreeIcon:pe,switcherIcon:U,treeLine:De,treeNodeFilterProp:F,keyEntities:A}},[z,we,J,V,Ke,Xe,Te,j,Ne,G,he,me,pe,U,De,F,A]);return c.createElement(wt.Provider,{value:Ht},c.createElement(bt.Provider,{value:Rt},c.createElement(Jt,Ue({ref:t},re,{id:$e,prefixCls:o,mode:_?"multiple":void 0,displayValues:Kt,onDisplayValuesChange:Ot,searchValue:K,onSearch:ye,OptionList:Tt,emptyOptions:!ae.length,onDropdownVisibleChange:At,dropdownMatchSelectWidth:te}))))}),ze=Tr;ze.TreeNode=it;ze.SHOW_ALL=Nt;ze.SHOW_PARENT=lt;ze.SHOW_CHILD=Je;var Nr=globalThis&&globalThis.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]]);return n},kr=function(t,n){var r=t.prefixCls,o=t.size,l=t.disabled,s=t.bordered,i=s===void 0?!0:s,a=t.className,u=t.treeCheckable,d=t.multiple,w=t.listHeight,S=w===void 0?256:w,I=t.listItemHeight,D=I===void 0?26:I,b=t.placement,$=t.notFoundContent,F=t.switcherIcon,W=t.treeLine,m=t.getPopupContainer,L=t.dropdownClassName,P=t.popupClassName,q=t.treeIcon,R=q===void 0?!1:q,Re=t.transitionName,ce=t.choiceTransitionName,be=ce===void 0?"":ce,Ve=t.status,ue=t.showArrow,we=t.treeExpandAction,J=Nr(t,["prefixCls","size","disabled","bordered","className","treeCheckable","multiple","listHeight","listItemHeight","placement","notFoundContent","switcherIcon","treeLine","getPopupContainer","dropdownClassName","popupClassName","treeIcon","transitionName","choiceTransitionName","status","showArrow","treeExpandAction"]),V=c.useContext(Ft),Te=V.getPopupContainer,j=V.getPrefixCls,Ne=V.renderEmpty,G=V.direction,ke=V.virtual,X=V.dropdownMatchSelectWidth,de=c.useContext(Wt),T=j("select",r),fe=j("select-tree",r),Z=j("tree-select",r),ee=jt(T,G),ve=ee.compactSize,te=ee.compactItemClassnames,De=mt(P||L,"".concat(Z,"-dropdown"),xe({},"".concat(Z,"-dropdown-rtl"),G==="rtl")),he=!!(u||d),pe=ue!==void 0?ue:J.loading||!he,U=c.useContext(lr),me=U.status,re=U.hasFeedback,$e=U.isFormItemInput,B=U.feedbackIcon,z=ur(me,Ve),ne=Zt(Ue(Ue({},J),{multiple:he,showArrow:pe,hasFeedback:re,feedbackIcon:B,prefixCls:T})),_=ne.suffixIcon,ge=ne.removeIcon,Le=ne.clearIcon,N;$!==void 0?N=$:N=(Ne||er)("Select");var Ce=Ut(J,["suffixIcon","itemIcon","removeIcon","clearIcon","switcherIcon"]),f=function(){return b!==void 0?b:G==="rtl"?"bottomRight":"bottomLeft"},E=ve||o||de,Y=c.useContext(zt),K=l??Y,Pe=mt(!r&&Z,xe(xe(xe(xe(xe({},"".concat(T,"-lg"),E==="large"),"".concat(T,"-sm"),E==="small"),"".concat(T,"-rtl"),G==="rtl"),"".concat(T,"-borderless"),!i),"".concat(T,"-in-form-item"),$e),sr(T,z,re),te,a),ye=j();return c.createElement(ze,Ue({virtual:ke,dropdownMatchSelectWidth:X,disabled:K},Ce,{ref:n,prefixCls:T,className:Pe,listHeight:S,listItemHeight:D,treeCheckable:u&&c.createElement("span",{className:"".concat(T,"-tree-checkbox-inner")}),treeLine:!!W,inputIcon:_,multiple:d,placement:f(),removeIcon:ge,clearIcon:Le,switcherIcon:function(Me){return nr(fe,F,W,Me)},showTreeIcon:R,notFoundContent:N,getPopupContainer:m||Te,treeMotion:null,dropdownClassName:De,choiceTransitionName:Ct(ye,"",be),transitionName:Ct(ye,cr(b),Re),showArrow:re||ue,treeExpandAction:we}))},Dr=c.forwardRef(kr),Qe=Dr;Qe.TreeNode=it;Qe.SHOW_ALL=Nt;Qe.SHOW_PARENT=lt;Qe.SHOW_CHILD=Je;const Lr=Qe;class He{constructor(){this._localDataService=Qt(),this.create=t=>new Promise(n=>{const r=this._localDataService.categories;r.push({id:Gt(),isActive:t.isActive?t.isActive:!0,mpath:"",name:t.name?t.name:"",order:t.order?t.order:0,parentCategoryId:t.parentCategoryId??null,typeId:t.typeId??O.EXPENSE}),this._localDataService.categories=r.sort((o,l)=>o.order-l.order),n()}),this.delete=t=>new Promise((n,r)=>{const o=this._localDataService.categories,l=o.findIndex(a=>a.id===t);if(l===-1){r("category delete, id not found:"+t);return}const i=this._localDataService.transactions.filter(a=>a.categoryId===t);i.length?(alert(`Счет сделан неактивным, а не удалён, т.к. по счету были найдены транзакции. 
Даты:
`+i.map(a=>Xt(a.dt)).join(`
`)),o[l].isActive=!1):(console.log("category delete",l),o.splice(l,1)),this._localDataService.categories=o,n()}),this.getOne=t=>this._localDataService.categories.find(r=>r.id===t),this.getTree=(t,n)=>new Promise(r=>{const l=this._localDataService.categories.filter(a=>{let u=!0;if(t){let d=t;t===O.RETURN_EXPENSE&&(d=O.EXPENSE),t===O.RETURN_INCOME&&(d=O.INCOME),a.typeId!==d&&(u=!1)}return!n&&!a.isActive&&(u=!1),u}),i=l.filter(a=>a.parentCategoryId===null).map(a=>{const u=l.filter(d=>a.id===d.parentCategoryId).map(d=>this.transformCategoryToTreeItem(d));return{...this.transformCategoryToTreeItem(a),children:u}});r(i)}),this.transformCategoryToTreeItem=t=>({id:t.id,key:t.id,value:t.id,isActive:t.isActive,title:t.name}),this.update=(t,n)=>new Promise((r,o)=>{const l=this._localDataService.categories,s=l.findIndex(i=>i.id===t);if(s===-1){console.error("categoryToUpdateIdx not found",t,n),o();return}l.splice(s,1),l.push({...n,id:t}),this._localDataService.categories=l.sort((i,a)=>i.order-a.order),r()})}static getInstance(){return He.instance||(He.instance=new He),He.instance}}const Pr=()=>He.getInstance(),Ee="categories",Mr=()=>{const e=Bt(),t=Pr();return{useCreate:()=>et(i=>t.create(i),{onSuccess:()=>{e.invalidateQueries([Ee])}}),useGetTree:i=>{const{typeId:a,showHidden:u}=i;return tt([Ee,"tree",a,u],()=>t.getTree(a,u))},useGetOne:i=>tt([Ee,"details",i],()=>t.getOne(i),{enabled:!!i}),useUpdate:(i,a)=>et(u=>t.update(i,u),{onSuccess:async()=>{await e.cancelQueries([Ee]),e.invalidateQueries([Ee]),a&&a()}}),useDelete:(i,a)=>et(u=>t.delete(u),{onSuccess:async()=>{await e.cancelQueries([Ee]),e.invalidateQueries([Ee]),a&&a()}})}},Wr=({typeId:e,onChange:t,value:n,allowClear:r,disabled:o})=>{const{isLoading:l,data:s}=Mr().useGetTree({typeId:e});return rt.jsx(Lr,{treeData:s,allowClear:r,loading:l,disabled:o||!e,onChange:t,value:n!=0?n:void 0,dropdownStyle:{overflow:"auto"},treeDefaultExpandAll:!0})},_r="transactionTypes",Et=[{id:O.EXPENSE,name:"Расход"},{id:O.INCOME,name:"Доход"},{id:O.RETURN_EXPENSE,name:"Возврат расхода"},{id:O.RETURN_INCOME,name:"Возврат дохода"},{id:O.TRANSFER,name:"Перевод между своими счетами"}],Kr=e=>new Promise(t=>{t(e?Et.filter(n=>n.id!==O.RETURN_EXPENSE&&n.id!==O.RETURN_INCOME):Et)}),Ar=e=>tt([_r,e],()=>Kr(!!e)),jr=({allowClear:e,value:t,hideReturns:n,disabled:r,onChange:o})=>{const{isLoading:l,data:s}=Ar(n);return rt.jsx(ar,{allowClear:e,loading:l,onChange:o,value:t,disabled:r,children:(s==null?void 0:s.length)&&(s==null?void 0:s.map(i=>rt.jsx(or,{value:i.id,children:i.name},i.id)))})};export{Wr as C,jr as T,Mr as u};
