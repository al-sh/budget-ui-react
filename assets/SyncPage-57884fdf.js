import{r as u,j as e,B as i,ac as y,V as w,ad as C}from"./index-5bce78cb.js";import{g as j,A as o}from"./Api-4bf88c6b.js";const T=(a,c,s)=>{const t=document.createElement("a"),d=new Blob([a],{type:s});t.href=URL.createObjectURL(d),t.download=c,t.click(),URL.revokeObjectURL(t.href)},r=async(a,c)=>{const s=new FormData;c&&s.append("fileData",c),await j().send({endpoint:a,method:"POST",isFile:!0,data:s})},F=()=>{const[a,c]=u.useState(void 0),s=j(),t=async()=>{a&&await r(o.SYNC+"/upload/categories",a)},d=async()=>{a&&await r(o.SYNC+"/upload/accounts",a)},x=async()=>{a&&await r(o.SYNC+"/upload/transactions",a)},S=async()=>{var h,p,g;const n={accounts:JSON.parse(localStorage.accounts),categories:JSON.parse(localStorage.categories),transactions:JSON.parse(localStorage.transactions)},l=await s.send({endpoint:o.SYNC+"/upload/all/raw",method:"POST",data:n});w.info({message:e.jsxs("div",{children:[e.jsxs("div",{children:["Количество ошибок: ",l.errors.length]}),e.jsxs("div",{children:[e.jsx("div",{children:e.jsx(C,{children:"Сохранено на бэке:"})}),e.jsxs("div",{children:[e.jsxs("div",{children:["Счетов: ",(h=l.imported)==null?void 0:h.accounts]}),e.jsxs("div",{children:["Категорий: ",(p=l.imported)==null?void 0:p.categories]}),e.jsxs("div",{children:["Транзакций: ",(g=l.imported)==null?void 0:g.transactions]})]})]})]})})},m=async()=>{a&&await r(o.SYNC+"/upload/all/file",a)},f=async()=>{if(prompt('Действие необратимо и затрёт все несохраненные локальные изменения. Введите "да", чтобы подтвердить действие')!=="да")return;const n=await s.send({endpoint:o.SYNC+"/download/all",method:"GET"});console.log(n),localStorage.accounts=JSON.stringify(n.accounts),localStorage.categories=JSON.stringify(n.categories),localStorage.transactions=JSON.stringify(n.transactions)};return e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Синхронизация"}),e.jsx("input",{type:"file",id:"file",name:"file",onChange:n=>{n.target.files&&n.target.files[0]&&c(n.target.files[0])}}),e.jsx("h3",{children:"Категории"}),e.jsx("div",{children:e.jsx(i,{onClick:t,children:"Загрузить"})}),e.jsx("h3",{style:{marginTop:30},children:"Счета"}),e.jsx("div",{children:e.jsx("span",{children:e.jsx(i,{onClick:d,children:"Загрузить"})})}),e.jsx("h3",{style:{marginTop:30},children:"Транзакции"}),e.jsx("div",{children:e.jsx(i,{onClick:x,children:"Загрузить"})}),e.jsx("h3",{style:{marginTop:30},children:"Всё сразу - файлы"}),e.jsxs("div",{children:[e.jsx(i,{onClick:async()=>{const n=await s.send({endpoint:o.SYNC+"/download/all",method:"GET"});T(JSON.stringify(n),`budget_${y(new Date)}.json`,"text/plain")},children:"Выгрузить"}),e.jsx(i,{onClick:m,children:"Загрузить"})]}),e.jsx("h3",{style:{marginTop:30},children:"Всё сразу - storage"}),e.jsxs("div",{children:[e.jsx(i,{onClick:S,children:"Сохранить"}),e.jsx(i,{onClick:f,children:"Получить"})]})]})};export{F as default};
