import{r as h,j as e,H as v,s as w,am as D,an as P,ao as A,ap as B,aq as O,o as u,ae as L,L as R,B as F}from"./index-e97f3cb2.js";import{D as I,A as G,f as T}from"./DatePicker-3e372ec0.js";import{T as M,C as N}from"./TransactionTypeSelect-f43a7dc5.js";import{B as S,H,a as V,F as z}from"./Button-e2b044c8.js";import{F as c}from"./index-41bdc4f4.js";import"./Select-6d7dc402.js";import"./KeyCode-6413d982.js";import"./index-701a036c.js";import"./useMergedState-82a668f8.js";const q=({params:t,onClear:a,onFinish:n})=>{const[s]=c.useForm(),[o,p]=h.useState(t.typeId?t.typeId:void 0),[r,l]=h.useState(!1);return e.jsx("div",{children:e.jsxs(c,{name:"TransactionsFilters",form:s,onValuesChange:()=>{p(s.getFieldValue("typeId")),l(s.getFieldsError().filter(({errors:d})=>d.length).length>0)},layout:"horizontal",labelAlign:"left",initialValues:t,onFinish:d=>{n(d)},autoComplete:"off",children:[e.jsxs("div",{style:{marginTop:20,display:"flex",alignItems:"baseline"},children:[e.jsx(c.Item,{name:"dateFrom",style:{display:"inline-block"},children:e.jsx(I,{placeholder:"Начало периода"})}),e.jsx("span",{style:{margin:"0 12px 0 12px"},children:"-"}),e.jsx(c.Item,{name:"dateEnd",style:{display:"inline-block"},children:e.jsx(I,{placeholder:"Конец периода"})})]}),e.jsx(c.Item,{label:"Счет",name:"accountId",children:e.jsx(G,{allowClear:!0})}),e.jsx(c.Item,{label:"Тип",name:"typeId",children:e.jsx(M,{allowClear:!0,onChange:()=>{s.setFieldsValue({categoryId:void 0})}})}),o!==v.TRANSFER&&e.jsx(c.Item,{label:"Категория",name:"categoryId",children:e.jsx(N,{allowClear:!0,typeId:o})}),e.jsx(c.Item,{wrapperCol:{offset:8,span:16},children:e.jsxs("div",{children:[e.jsx(S,{type:"link",onClick:()=>{a()},children:"Очистить"}),e.jsx(S,{type:"primary",htmlType:"submit",disabled:r,children:"Применить"})]})})]})})},J=w.div`
  margin: 20px 0 20px 0;
`,C=D(({date:t,transactions:a})=>e.jsxs(J,{children:[e.jsx(P,{children:t}),a.map(n=>e.jsx(A,{tran:n,showOnlyTime:!0},n.id))]}));C.displayName="TransactionsGroup";const U=t=>{var n;const a=new Map;for(let s=0;s<t.length;s++){const o=B(t[s].dt);a.get(o)||a.set(o,[]),(n=a.get(o))==null||n.push(t[s])}return a},W=({transactions:t})=>{const a=h.useMemo(()=>U(t||[]),[JSON.stringify(t)]),n=[...a.keys()];return e.jsx(e.Fragment,{children:n.length>0&&n.map(s=>e.jsx(C,{date:s,transactions:a.get(s)||[]},s))})},se=()=>{const[t,a]=h.useState(!1),[n,s]=h.useState(0),[o,p]=O(),r=Object.fromEntries(new URLSearchParams(o)),l={typeId:r.typeId?parseInt(r.typeId):void 0};if(String(r.categoryId)!=="undefined"&&(l.categoryId=r.categoryId),String(r.accountId)!=="undefined"&&(l.accountId=r.accountId),String(r.dateFrom)!=="undefined")l.dateFrom=u(r.dateFrom);else{const i=new Date;i.setDate(1),l.dateFrom=u(i)}String(r.dateEnd)!=="undefined"&&(l.dateEnd=u(r.dateEnd));const[d,x]=h.useState(l),{useGetList:b}=L(),{isLoading:E,isError:k,data:f}=b(d);let y=0;for(const i in d)d[i]&&y++;return e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(V,{children:"История"}),e.jsx(z,{onClick:()=>{a(!t)},showFilters:t,filtersCount:y})]}),t&&e.jsx(q,{params:d,onClear:()=>{a(!1),x({})},onFinish:i=>{a(!1),x(i);const m={};for(const j in i)if(i[j]!==void 0){const g=j;m[g]=i[g]}p({...m,...m.dateFrom&&{dateFrom:m.dateFrom.format(T.dateMoment.short)},...m.dateEnd&&{dateEnd:m.dateEnd.format(T.dateMoment.short)}})}}),k&&e.jsx(e.Fragment,{children:"Ошибка загрузки транзакций"}),E&&e.jsx("div",{style:{textAlign:"center",width:"100%"},children:e.jsx(R,{size:"large"})}),f&&e.jsx(W,{transactions:f}),e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsxs("span",{style:{marginRight:"0.5rem"},children:["Страница: ",n+1]}),n>0&&e.jsx(F,{onClick:()=>{s(n-1)},children:"Предыдущая"}),e.jsx(F,{onClick:()=>{s(n+1)},children:"Следующая"})]})]})};export{se as TransactionsPage,se as default};
